<?xml version="1.0" encoding="UTF-8"?>
<!--
ALMA - Atacama Large Millimeter Array
Copyright (c) AUI - Associated Universities Inc., 2011
(in the framework of the ALMA collaboration).
All rights reserved.

This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307  USA
-->
<!DOCTYPE hibernate-mapping PUBLIC
    "-//Hibernate/Hibernate Mapping DTD//EN"
    "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping package="alma.scheduling.datamodel.executive">

    <class name="Executive" table="EXECUTIVE">
    	<id name="id" column="ID">            
    		<generator class="native"/>
    	</id>
    	<property name="name" column="NAME" type="string"/>
        <property name="defaultPercentage" column="DEFAULT_PERCENTAGE" type="float"/>
		<set name="executivePercentage" inverse="true">
			<key column="EXECUTIVE_ID" />
			<one-to-many class="ExecutivePercentage" />
		</set>
	</class>
	
	<class name="ObservingSeason" table="OBSERVING_SEASON">
		<id name="id" column="ID">            
			<generator class="native"/>
		</id>
		<property name="name" type="string" column="NAME"/>
		<property name="startDate" type="timestamp" column="START_DATE"/>
		<property name="endDate" type="timestamp" column="END_DATE"/>
		<set name="executivePercentage" inverse="true">
			<key column="SEASON_ID" />
			<one-to-many class="ExecutivePercentage" />
		</set>
		<component class="TimeInterval" name="observingInterval">
			<property name="startTime" column="DAILY_INTERVAL_START_TIME" type="long"/>
			<property name="duration" column="DAILY_INTERVAL_DURATION" type="long"/>
		</component>
	</class>
	
	<class name="ExecutivePercentage" table="EXECUTIVE_PERCENTAGE">
		<composite-id name="id" class="ExecutivePercentage$Id">
			<key-property name="executiveId" access="field" column="EXECUTIVE_ID"/>
			<key-property name="seasonId" access="field" column="SEASON_ID"/>
		</composite-id>		
		<property name="percentage" type="float" column="PERCENTAGE"/>
		<property name="totalObsTimeForSeason" type="double" column="TOTAL_OBS_TIME_FOR_SEASON" />
		<property name="remainingObsTime" type="double" column="REMAINING_OBSTIME" />
		<many-to-one name="executive" column="EXECUTIVE_ID" not-null="true" insert="false" update="false"/>
		<many-to-one name="season" column="SEASON_ID" not-null="true" insert="false" update="false"/>
	</class>
	
	<class name="ExecutiveTimeSpent" table="EXECUTIVE_TIME_SPENT">
		<id column="ID" type="long">
			<generator class="native"/>
		</id>
		<property name="timeSpent" type="float" column="TIME_SPENT" not-null="true"/>
		<property name="sbId" type="long" column="SB_ID" not-null="true"/>
		<many-to-one name="observingSeason" column="OBS_SEASON_ID" 
        	 not-null="true" class="ObservingSeason"/>
        <many-to-one name="executive" column="EXECUTIVE_NAME" 
        	 not-null="true" class="Executive"/>
	</class>
		
	<class name="PI" table="PI">
		<id name="id" column="ID" type="long">
			<generator class="native"/>
		</id>
		<property name="email" column="EMAIL" type="string"/>
		<property name="name" column="NAME" type="string"/>
		<set name="PIMembership" table="PI_MEMBERSHIP" cascade="save-update,lock, delete, delete-orphan">
			<key column="PI_ID" />
			<one-to-many class="PIMembership" />
		</set>
	</class>
	
	<class name="PIMembership" table="PI_MEMBERSHIP" >
		<id	column="ID" type="long">
			<generator class="native"/>
		</id>
		<property name="membershipPercentage" type="float" column="PERCENTAGE" />
		<many-to-one name="executive" column="EXECUTIVE_NAME" 
        	not-null="true" class="Executive"/>
	</class>
	
  	<query name="ExecutiveTimeSpent.findBySeasonAndExecutive">
		<![CDATA[
			from ExecutiveTimeSpent ets 
			where ets.observingSeason.startDate = ? and ets.executive.name = ? 
		]]>
	</query>
	
</hibernate-mapping>    
