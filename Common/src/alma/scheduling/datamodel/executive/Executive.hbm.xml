<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC
    "-//Hibernate/Hibernate Mapping DTD//EN"
    "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping package="alma.scheduling.datamodel.executive">

    <class name="Executive" table="EXECUTIVE">
        <id name="name" column="NAME" type="string">
        	<generator class="assigned"/>
        </id>
        
        <property name="defaultPercentage" column="DEFAULT_PERCENTAGE" type="float"/>
        
		<set name="ExecutivePercentage" table="EXECUTIVE_PERCENTAGE" cascade="save-update,lock, delete, delete-orphan">
			<key column="EXECUTIVE_NAME" />
			<one-to-many class="ExecutivePercentage" />
		</set>
		
		<set name="SchedBlockExecutivePercentage" table="SB_EXECUTIVE_PERCENTAGE" cascade="save-update,lock, delete, delete-orphan">
			<key column="EXECUTIVE_NAME" />
			<one-to-many class="SchedBlockExecutivePercentage" />
		</set>
	</class>
	
	<class name="ExecutivePercentage" table="EXECUTIVE_PERCENTAGE">
		<id column="ID" type="long">
			<generator class="native"/>
		</id>
		
		<property name="percentage" type="float" column="PERCENTAGE"/>
		<property name="totalObsTimeForSeason" type="float" column="TOTAL_OBS_TIME_FOR_SEASON" />
	</class>
	
	<class name="ObservingSeason" table="OBSERVING_SEASON">
		<id name="startDate" column="START_DATE" type="timestamp">
			<generator class="assigned"/>
		</id>
		
		<property name="name" type="string" column="NAME"/>
		<property name="endDate" type="timestamp" column="END_DATE"/>
		<set name="ExecutivePercentage" table="EXECUTIVE_PERCENTAGE" cascade="save-update,lock, delete, delete-orphan">
			<key column="START_DATE" />
			<one-to-many class="ExecutivePercentage" />
		</set>
	</class>
	
	<class name="ExecutiveTimeSpent" table="EXECUTIVE_TIME_SPENT">
		<id column="ID" type="long">
			<generator class="native"/>
		</id>
		
		<property name="timeSpent" type="float" column="TIME_SPENT" not-null="true"/>
		<property name="sbId" type="long" column="SB_ID" not-null="true"/>
		<many-to-one name="observingSeason" column="OBS_SEASON_ID" 
        	 not-null="true" class="ObservingSeason"/>
        <many-to-one name="executive" column="EXECUTIVE_NAME" 
        	 not-null="true" class="Executive"/>
	</class>
	
	<class name="SchedBlockExecutivePercentage" table="SB_EXECUTIVE_PERCENTAGE">
		<id column="ID" type="long">
			<generator class="native"/>
		</id>
		<property name="percentage" type="float" column="PERCENTAGE"/>
		<property name="sbid" type="string" column="SBID"/>
		<property name="executionTime" type="long" column="EXEC_TIME"/>
	</class>
	
	<class name="PI" table="PI">
		<id name="name" column="NAME" type="string">
			<generator class="assigned"/>
		</id>
		<set name="PIMembership" table="PI_MEMBERSHIP" cascade="save-update,lock, delete, delete-orphan">
			<key column="PI_NAME" />
			<one-to-many class="PIMembership" />
		</set>
	</class>
	
	<class name="PIMembership" table="PI_MEMBERSHIP" >
		<id	column="ID" type="long">
			<generator class="native"/>
		</id>
		<property name="membershipPercentage" type="float" column="PERCENTAGE" />
		<many-to-one name="executive" column="EXECUTIVE_NAME" 
        	not-null="true" class="Executive"/>
	</class>
	
  	<query name="ExecutiveTimeSpent.findBySeasonAndExecutive">
		<![CDATA[
			from ExecutiveTimeSpent ets 
			where ets.observingSeason.startDate = ? and ets.executive.name = ? 
		]]>
	</query>
	
	<sql-query name="ExecutivePercentage.findBySeasonAndExecutive">
	<return alias="ep" class="ExecutivePercentage" />
		SELECT * FROM EXECUTIVE_PERCENTAGE WHERE
		  EXECUTIVE_PERCENTAGE.START_DATE = ? AND
		  EXECUTIVE_PERCENTAGE.EXECUTIVE_NAME = ?
	</sql-query>
	
</hibernate-mapping>    
